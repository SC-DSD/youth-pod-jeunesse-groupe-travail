<html>
<body>
<script rel="javascript" type="text/javascript" src="vignettes.js"></script>

<p>Fetching, sorting and displaying JSON objects.</p>
<form id="fetch" action="#">
  <fieldset>
    <legend>Youth services:</legend>
    Audience:<br>
    <select id="audience">
        <option value="0">0</option>
        <option value="1">1</option>
        <option value="2">2</option>
        <option value="3">3</option>
        <option value="4">4</option>
        <option value="5">5</option>
      </select> <br>
    Task:<br>
    <select id="task">
        <option value="0">0</option>
         <option value="1">1</option>
        <option value="2">2</option>
      </select> <br>
    Goal:<br>
    <select id="goal">
        <option value="0">0</option>
         <option value="1">1</option>
        <option value="2">2</option>
      </select> <br><br>
      <input type="button" value="submit" onclick="ffetch();" />
  </fieldset>
</form>
<p id="sResults"></p>

<script>
var myObj;

function ffetch(){
  
  aud = parseInt(document.getElementById("audience").value);
  objec = parseInt(document.getElementById("task").value);
  gl = parseInt(document.getElementById("goal").value);
  var i, j, k, l, x="";
  var relcount = 0;
  var rescount = 0;

  //relevance algorithm calculaton, storage and relevant results count.
    for (i in myObj.vignette) {
        myObj.vignette[i].val = parseInt(myObj.vignette[i].relevance[0].audience[aud] * myObj.vignette[i].relevance[1].objective[objec] * myObj.vignette[i].relevance[2].goal[gl]); 
      
        if(myObj.vignette[i].val != 1){    
          relcount++;
        }
        rescount++;
      }
      
      // sort by value
      myObj.vignette.sort(function (a, b) {
        return b.val - a.val;
      });
      
      //show results
      for(j in myObj.vignette){
        if(myObj.vignette[j].val > 1)
          x += "<h2>" + myObj.vignette[j].title + "</h2><p><a href='"+ myObj.vignette[j].url +"'>" + myObj.vignette[j].url + "</a></p><p>" +  myObj.vignette[j].descriptor + "</p><p>" + myObj.vignette[j].val + " is the relevance value for " + myObj.vignette[j].title + "</p>";  
      }
      
      //nothing comes up
      if(relcount == 0){
        x = "No value could be returned for your current search terms";
      }

      
      x += "<p><strong>"+ relcount +" relevant results are displayed out of " + rescount + "</strong></p>";
      
      document.getElementById("sResults").innerHTML = x;

    }

ffetch();
</script>
</body>
</html>